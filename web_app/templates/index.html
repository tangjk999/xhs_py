<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°çº¢ä¹¦çƒ­é—¨åšå®¢åˆ†æç³»ç»Ÿ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #ff2442;
            --secondary-color: #ff6b81;
            --accent-color: #ff8fa3;
            --dark-color: #2c3e50;
            --light-color: #f8f9fa;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }
        
        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }
        
        .main-container {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            margin: 2rem auto;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }
        
        .metric-card {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1.5rem;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .metric-card:hover {
            transform: translateY(-5px);
        }
        
        .metric-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .metric-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem;
        }
        
        .card-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 15px 15px 0 0 !important;
            border: none;
            padding: 1rem 1.5rem;
        }
        
        .btn {
            border-radius: 10px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border: none;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 36, 66, 0.4);
        }
        
        .form-control, .form-select {
            border-radius: 10px;
            border: 1px solid #e9ecef;
            padding: 0.75rem 1rem;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(255, 36, 66, 0.25);
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }
        
        .result-section {
            display: none;
        }
        
        .alert {
            border-radius: 10px;
            border: none;
            margin-bottom: 1rem;
        }
        
        .alert-success {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }
        
        .alert-danger {
            background: linear-gradient(135deg, #dc3545, #fd7e14);
            color: white;
        }
        
        .progress {
            height: 8px;
            border-radius: 10px;
            background: #e9ecef;
            margin: 1rem 0;
        }
        
        .progress-bar {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 10px;
        }
        
        .tab-content {
            padding: 1rem 0;
        }
        
        .nav-tabs {
            border-bottom: 2px solid #e9ecef;
        }
        
        .nav-tabs .nav-link {
            border: none;
            border-radius: 15px 15px 0 0;
            margin-right: 0.5rem;
            color: #6c757d;
            font-weight: 500;
        }
        
        .nav-tabs .nav-link.active {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
        }
        
        .data-table {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .data-table th {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 1rem;
        }
        
        .data-table td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #e9ecef;
        }
        
        .data-table tbody tr:hover {
            background: #f8f9fa;
        }
        
        .floating-action-btn {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .floating-action-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(0,0,0,0.4);
        }
        
        /* åšå®¢åˆ—è¡¨æ ·å¼ */
        .blog-list-item {
            border: none;
            border-bottom: 1px solid #e9ecef;
            border-radius: 0;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .blog-list-item:hover {
            background: linear-gradient(135deg, rgba(255, 36, 66, 0.1), rgba(255, 107, 129, 0.1));
            transform: translateX(5px);
        }
        
        .blog-list-item.active {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-left: 4px solid white;
        }
        
        .blog-list-item .blog-title {
            font-weight: 500;
            margin-bottom: 0.5rem;
            line-height: 1.4;
        }
        
        .blog-list-item .blog-meta {
            font-size: 0.85rem;
            opacity: 0.8;
        }
        
        .blog-list-item .blog-stats {
            display: flex;
            gap: 1rem;
            margin-top: 0.5rem;
        }
        
        .blog-list-item .stat-item {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        /* åšå®¢è¯¦æƒ…æ ·å¼ */
        .blog-detail-header {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 1.5rem;
        }
        
        .blog-detail-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 1rem;
            color: var(--dark-color);
        }
        
        .blog-detail-author {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .blog-detail-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .stat-card {
            background: white;
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .stat-label {
            font-size: 0.85rem;
            color: #6c757d;
            margin-top: 0.25rem;
        }
        
        .blog-detail-content {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .blog-detail-section {
            margin-bottom: 2rem;
        }
        
        .blog-detail-section h5 {
            color: var(--primary-color);
            margin-bottom: 1rem;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 0.5rem;
        }
        
        @media (max-width: 768px) {
            .main-container {
                margin: 1rem;
                padding: 1rem;
            }
            
            .metric-value {
                font-size: 2rem;
            }
            
            .chart-container {
                height: 250px;
            }
            
            .blog-list-item {
                padding: 1rem;
            }
            
            .blog-detail-header {
                padding: 1rem;
            }
            
            .blog-detail-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-chart-line me-2"></i>
                å°çº¢ä¹¦åˆ†æç³»ç»Ÿ
            </a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text">
                    <i class="fas fa-clock me-1"></i>
                    <span id="current-time"></span>
                </span>
            </div>
        </div>
    </nav>

    <!-- ä¸»è¦å†…å®¹ -->
    <div class="container">
        <div class="main-container">
            <!-- ç³»ç»ŸçŠ¶æ€ -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="metric-card">
                        <div class="metric-value" id="total-notes">0</div>
                        <div class="metric-label">æ€»ç¬”è®°æ•°</div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="metric-card">
                        <div class="metric-value" id="avg-likes">0</div>
                        <div class="metric-label">å¹³å‡ç‚¹èµ</div>
                    </div>
                </div>
            </div>

            <!-- åŠŸèƒ½æ ‡ç­¾é¡µ -->
            <ul class="nav nav-tabs" id="mainTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="crawl-tab" data-bs-toggle="tab" data-bs-target="#crawl" type="button" role="tab">
                        <i class="fas fa-spider me-2"></i>æ™ºèƒ½çˆ¬å–
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="analyze-tab" data-bs-toggle="tab" data-bs-target="#analyze" type="button" role="tab">
                        <i class="fas fa-brain me-2"></i>AIåˆ†æ
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="visualize-tab" data-bs-toggle="tab" data-bs-target="#visualize" type="button" role="tab">
                        <i class="fas fa-chart-bar me-2"></i>å¯è§†åŒ–
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="settings-tab" data-bs-toggle="tab" data-bs-target="#settings" type="button" role="tab">
                        <i class="fas fa-cog me-2"></i>è®¾ç½®
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="about-tab" data-bs-toggle="tab" data-bs-target="#about" type="button" role="tab">
                        <i class="fas fa-info-circle me-2"></i>å…³äº
                    </button>
                </li>
            </ul>

            <div class="tab-content" id="mainTabsContent">
                <!-- çˆ¬å–æ ‡ç­¾é¡µ -->
                <div class="tab-pane fade show active" id="crawl" role="tabpanel">
                    <!-- çˆ¬å–è®¾ç½® -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <i class="fas fa-spider me-2"></i>
                            æ™ºèƒ½çˆ¬å–è®¾ç½®
                        </div>
                        <div class="card-body">
                            <form id="crawlForm">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="topic" class="form-label">æœç´¢ä¸»é¢˜</label>
                                            <input type="text" class="form-control" id="topic" name="topic" 
                                                   placeholder="ä¾‹å¦‚ï¼šç¾é£Ÿã€æ—…è¡Œã€ç¾å¦†..." required>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="limit" class="form-label">è·å–æ•°é‡</label>
                                            <select class="form-control" id="limit" name="limit">
                                                <option value="10">10æ¡</option>
                                                <option value="20" selected>20æ¡</option>
                                                <option value="50">50æ¡</option>
                                                <option value="100">100æ¡</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <!-- éšè—çš„Cookieå­—æ®µ -->
                                <input type="hidden" id="cookies" name="cookies">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-play me-2"></i>å¼€å§‹çˆ¬å–
                                </button>
                            </form>
                        </div>
                    </div>

                    <!-- çˆ¬å–è¿›åº¦ -->
                    <div class="loading" id="crawlLoading">
                        <div class="spinner-border" role="status">
                            <span class="visually-hidden">çˆ¬å–ä¸­...</span>
                        </div>
                        <p class="mt-3">æ­£åœ¨çˆ¬å–æ•°æ®ï¼Œè¯·ç¨å€™...</p>
                        <div class="progress">
                            <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                 role="progressbar" style="width: 0%"></div>
                        </div>
                    </div>

                    <!-- æ•°æ®å±•ç¤ºåŒºåŸŸ -->
                    <div class="result-section" id="crawlResult" style="display: none;">
                        <div class="row">
                            <!-- å·¦ä¾§ï¼šåšå®¢åˆ—è¡¨ -->
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-list me-2"></i>
                                        åšå®¢åˆ—è¡¨
                                        <span class="badge bg-primary ms-2" id="blogCount">0</span>
                                    </div>
                                    <div class="card-body p-0">
                                        <div class="list-group list-group-flush" id="blogList">
                                            <!-- åšå®¢åˆ—è¡¨é¡¹å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- å³ä¾§ï¼šè¯¦ç»†åˆ†æ -->
                            <div class="col-md-8">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-chart-line me-2"></i>
                                        è¯¦ç»†åˆ†æ
                                        <span class="text-muted ms-2" id="selectedBlogTitle">è¯·é€‰æ‹©å·¦ä¾§åšå®¢æŸ¥çœ‹è¯¦æƒ…</span>
                                    </div>
                                    <div class="card-body">
                                        <div id="blogDetail">
                                            <div class="text-center text-muted py-5">
                                                <i class="fas fa-hand-pointer fa-3x mb-3"></i>
                                                <p>ç‚¹å‡»å·¦ä¾§åšå®¢æŸ¥çœ‹è¯¦ç»†åˆ†æ</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- åˆ†ææ ‡ç­¾é¡µ -->
                <div class="tab-pane fade" id="analyze" role="tabpanel">
                    <div class="card">
                        <div class="card-header">
                                <i class="fas fa-brain me-2"></i>
                            AIæ·±åº¦åˆ†æ
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                            <div class="mb-3">
                                        <label for="analysisFile" class="form-label">é€‰æ‹©æ•°æ®æ–‡ä»¶</label>
                                        <select class="form-control" id="analysisFile" name="analysisFile">
                                            <option value="">è¯·å…ˆçˆ¬å–æ•°æ®...</option>
                                </select>
                            </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="analysisType" class="form-label">åˆ†æç±»å‹</label>
                                        <select class="form-control" id="analysisType" name="analysisType">
                                            <option value="comprehensive">ç»¼åˆåˆ†æ</option>
                                            <option value="trends">è¶‹åŠ¿åˆ†æ</option>
                                            <option value="ai">AIæ·±åº¦åˆ†æ</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="btn btn-success" id="analyzeBtn">
                                <i class="fas fa-magic me-2"></i>å¼€å§‹åˆ†æ
                            </button>
                            </div>
                        </div>

                    <!-- åˆ†æè¿›åº¦ -->
                    <div class="loading" id="analyzeLoading">
                        <div class="spinner-border" role="status">
                            <span class="visually-hidden">åˆ†æä¸­...</span>
                    </div>
                        <p class="mt-3">æ­£åœ¨è¿›è¡ŒAIåˆ†æï¼Œè¯·ç¨å€™...</p>
                        <div class="progress">
                            <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                 role="progressbar" style="width: 0%"></div>
                </div>
            </div>

            <!-- åˆ†æç»“æœ -->
                    <div class="result-section" id="analyzeResult">
                <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <div>
                            <i class="fas fa-chart-pie me-2"></i>
                            åˆ†æç»“æœ
                                </div>
                                <div>
                                    <button type="button" class="btn btn-sm btn-outline-primary" id="exportAnalysis">
                                        <i class="fas fa-download me-1"></i>å¯¼å‡º
                                    </button>
                                </div>
                    </div>
                    <div class="card-body">
                                <div id="analysisContent"></div>
                                </div>
                            </div>
                                </div>
                            </div>

                <!-- å¯è§†åŒ–æ ‡ç­¾é¡µ -->
                <div class="tab-pane fade" id="visualize" role="tabpanel">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <div>
                                <i class="fas fa-chart-bar me-2"></i>
                                æ•°æ®å¯è§†åŒ–
                                </div>
                            <div>
                                <button type="button" class="btn btn-sm btn-outline-primary" id="downloadCharts">
                                    <i class="fas fa-image me-1"></i>ä¸‹è½½
                                </button>
                            </div>
                                </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="chart-container">
                                        <canvas id="authorChart"></canvas>
                            </div>
                        </div>
                                <div class="col-md-6">
                                    <div class="chart-container">
                                        <canvas id="likesChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        <div class="row">
                                <div class="col-md-12">
                                    <div class="chart-container">
                                        <canvas id="trendChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- è®¾ç½®æ ‡ç­¾é¡µ -->
                <div class="tab-pane fade" id="settings" role="tabpanel">
                                <div class="card">
                                    <div class="card-header">
                            <i class="fas fa-cog me-2"></i>
                            ç³»ç»Ÿè®¾ç½®
                                    </div>
                                    <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="apiKey" class="form-label">DeepSeek APIå¯†é’¥</label>
                                        <input type="password" class="form-control" id="apiKey" name="apiKey" 
                                               placeholder="è¾“å…¥ä½ çš„DeepSeek APIå¯†é’¥">
                                        <div class="form-text">ç”¨äºAIåˆ†æåŠŸèƒ½ï¼Œä¸å¡«åˆ™ä½¿ç”¨æ¨¡æ‹Ÿåˆ†æ</div>
                                        </div>
                                    <button type="button" class="btn btn-primary" id="saveApiKey">
                                        <i class="fas fa-save me-2"></i>ä¿å­˜APIå¯†é’¥
                                    </button>
                                    </div>
                                <!-- Cookieè½¬æ¢å™¨ -->
                                <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                            <i class="fas fa-exchange-alt me-2"></i>
                                            Cookieè½¬æ¢ä¸ä¿å­˜
                                    </div>
                                    <div class="card-body">
                                            <!-- CookieçŠ¶æ€æ˜¾ç¤º -->
                                            <div class="mb-3">
                                                <label class="form-label">CookieçŠ¶æ€</label>
                                                <div class="d-flex align-items-center mb-2">
                                                    <div id="cookieStatus" class="badge bg-secondary me-2">æ£€æŸ¥ä¸­...</div>
                                                    <button type="button" class="btn btn-sm btn-outline-primary" id="checkCookieStatus">
                                                        <i class="fas fa-sync-alt"></i>æ£€æŸ¥
                                                    </button>
                                                </div>
                                                <small class="text-muted" id="cookieStatusMessage">æ­£åœ¨æ£€æŸ¥Cookieæœ‰æ•ˆæ€§...</small>
                                            </div>
                                            
                                            <div class="mb-3">
                                                <label for="rawCookies" class="form-label">åŸå§‹Cookieæ ¼å¼</label>
                                                <textarea class="form-control" id="rawCookies" name="rawCookies" rows="3" 
                                                          placeholder="ç²˜è´´ä»æµè§ˆå™¨å¤åˆ¶çš„cookieæ ¼å¼..."></textarea>
                                        </div>
                                            <div class="d-flex">
                                                <button type="button" class="btn btn-info me-2" id="convertCookies">
                                                    <i class="fas fa-magic me-2"></i>è½¬æ¢
                                                </button>
                                                <button type="button" class="btn btn-success" id="saveCookies">
                                                    <i class="fas fa-save me-2"></i>ä¿å­˜Cookies
                                                </button>
                                            </div>
                                            <div class="mt-3" id="convertedCookies" style="display: none;">
                                                <label class="form-label">è½¬æ¢ç»“æœ</label>
                                                <textarea class="form-control" id="jsonCookies" name="jsonCookies" rows="3" readonly></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    <!-- æ–‡ä»¶ç®¡ç† -->
                    <div class="card">
                            <div class="card-header">
                            <i class="fas fa-folder me-2"></i>
                            æ–‡ä»¶ç®¡ç†
                            </div>
                            <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6>æ•°æ®æ–‡ä»¶</h6>
                                    <div class="file-list" id="dataFiles"></div>
                                </div>
                                <div class="col-md-6">
                                    <h6>åˆ†ææ–‡ä»¶</h6>
                                    <div class="file-list" id="analysisFiles"></div>
                                </div>
                            </div>
                        </div>
                            </div>
                        </div>

                <!-- å…³äºæ ‡ç­¾é¡µ -->
                <div class="tab-pane fade" id="about" role="tabpanel">
                    <div class="card">
                            <div class="card-header">
                            <i class="fas fa-info-circle me-2"></i>
                            å…³äºé¡¹ç›®
                            </div>
                            <div class="card-body">
                            <div class="row">
                                <div class="col-md-8">
                                    <h5>å°çº¢ä¹¦åˆ†æç³»ç»Ÿ</h5>
                                    <p class="text-muted">åŸºäºPythonçš„å°çº¢ä¹¦æ•°æ®çˆ¬å–ä¸AIåˆ†æç³»ç»Ÿ</p>
                                    
                                    <h6>ä¸»è¦åŠŸèƒ½</h6>
                                    <ul>
                                        <li>ğŸ•·ï¸ æ™ºèƒ½çˆ¬å–ï¼šä»å°çº¢ä¹¦çˆ¬å–æŒ‡å®šä¸»é¢˜çš„çƒ­é—¨åšå®¢æ•°æ®</li>
                                        <li>ğŸ¤– AIåˆ†æï¼šåˆ©ç”¨DeepSeekå¤§æ¨¡å‹è¿›è¡Œæ·±åº¦åˆ†æ</li>
                                        <li>ğŸ“Š å¯è§†åŒ–å±•ç¤ºï¼šç°ä»£åŒ–ç•Œé¢å±•ç¤ºåˆ†æç»“æœ</li>
                                        <li>ğŸ”§ æ•°æ®å¯¼å‡ºï¼šæ”¯æŒå¤šç§æ ¼å¼å¯¼å‡º</li>
                                    </ul>
                                    
                                    <h6>æŠ€æœ¯æ ˆ</h6>
                                    <p>Python + Flask + Selenium + DeepSeek API + Bootstrap</p>
                                    
                                    <h6>éƒ¨ç½²æ–¹å¼</h6>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <a href="https://app.netlify.com/start/deploy?repository=https://github.com/your-repo/xhs_py" target="_blank" class="btn btn-sm btn-primary">
                                                <img src="https://www.netlify.com/img/deploy/button.svg" alt="Deploy to Netlify">
                                            </a>
                            </div>
                                        <div class="col-md-6">
                                            <code>docker run -p 8080:8080 xhs-analyzer</code>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card">
                                        <div class="card-body text-center">
                                            <h6>é¡¹ç›®ä¿¡æ¯</h6>
                                            <p><strong>ç‰ˆæœ¬ï¼š</strong>1.0.0</p>
                                            <p><strong>è®¸å¯è¯ï¼š</strong>MIT</p>
                                            <hr>
                                            <a href="#" class="btn btn-sm btn-outline-primary" onclick="switchToTab('crawl')">å¼€å§‹ä½¿ç”¨</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æµ®åŠ¨æ“ä½œæŒ‰é’® -->
    <button class="floating-action-btn" id="scrollToTop" title="å›åˆ°é¡¶éƒ¨">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- Toastå¼¹çª—å®¹å™¨ -->
    <div id="toastContainer" style="position: fixed; left: 50%; bottom: 40px; transform: translateX(-50%); z-index: 9999; min-width: 320px; max-width: 90vw; pointer-events: none;"></div>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
    <script>
        // å…¨å±€å˜é‡
        let currentData = null;
        let charts = {};
        let tableState = { page: 1, pageSize: 20, search: '' };

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateTime();
            setInterval(updateTime, 1000);
            loadSettings();
            loadFiles();
            initializeCharts();
            
            // ç»‘å®šäº‹ä»¶
            bindEvents();
            
            // è‡ªåŠ¨æ£€æŸ¥CookieçŠ¶æ€
            setTimeout(checkCookieStatus, 1000);
        });

        // æ›´æ–°æ—¶é—´
        function updateTime() {
            const now = new Date();
            document.getElementById('current-time').textContent = now.toLocaleString('zh-CN');
        }

        // ç»‘å®šäº‹ä»¶
        function bindEvents() {
            // çˆ¬å–è¡¨å•æäº¤
            document.getElementById('crawlForm').addEventListener('submit', handleCrawl);
            
            // åˆ†ææŒ‰é’®
            document.getElementById('analyzeBtn').addEventListener('click', handleAnalyze);
            
            // è®¾ç½®ä¿å­˜
            document.getElementById('saveApiKey').addEventListener('click', saveApiKey);
            document.getElementById('saveCookies').addEventListener('click', saveCookies);
            
            // Cookieè½¬æ¢
            document.getElementById('convertCookies').addEventListener('click', convertCookies);
            
            // æ£€æŸ¥CookieçŠ¶æ€
            document.getElementById('checkCookieStatus').addEventListener('click', checkCookieStatus);
            
            // å›åˆ°é¡¶éƒ¨
            document.getElementById('scrollToTop').addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });

            // è¡¨æ ¼æœç´¢å’Œåˆ†é¡µåŠŸèƒ½ï¼ˆå¦‚æœå­˜åœ¨å¯¹åº”å…ƒç´ ï¼‰
            const tableSearch = document.getElementById('tableSearch');
            if (tableSearch) {
                tableSearch.addEventListener('input', function(e) {
                    tableState.search = e.target.value.trim();
                    tableState.page = 1;
                    renderCrawlTable();
                });
            }
            
            const tablePageSize = document.getElementById('tablePageSize');
            if (tablePageSize) {
                tablePageSize.addEventListener('change', function(e) {
                    tableState.pageSize = parseInt(e.target.value);
                    tableState.page = 1;
                    renderCrawlTable();
                });
            }
            
            // å¯¼å‡ºåŠŸèƒ½ï¼ˆå¦‚æœå­˜åœ¨å¯¹åº”å…ƒç´ ï¼‰
            const exportCsv = document.getElementById('exportCsv');
            if (exportCsv) {
                exportCsv.addEventListener('click', exportTableToCsv);
            }
            
            document.getElementById('exportAnalysis').addEventListener('click', exportAnalysisToJson);
            
            document.getElementById('downloadCharts').addEventListener('click', downloadCharts);

            document.getElementById('cookies').addEventListener('input', function(e) {
                const val = e.target.value.trim();
                if (val.startsWith('{')) {
                    e.target.value = '';
                    showError('æ ¼å¼é”™è¯¯', 'è¯·ç²˜è´´æµè§ˆå™¨å¤åˆ¶çš„åŸå§‹cookieï¼ˆå¤šå­—æ®µã€tabåˆ†éš”ï¼‰ï¼Œä¸è¦ç²˜è´´JSONæ ¼å¼ï¼');
                }
            });
        }

        // å¤„ç†çˆ¬å–
        async function handleCrawl(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = {
                topic: formData.get('topic'),
                limit: parseInt(formData.get('limit')),
                cookies: formData.get('cookies')
            };
            
            showLoading('crawlLoading');
            hideResult('crawlResult');
            
            try {
                const response = await fetch('/api/crawl', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showSuccess('çˆ¬å–æˆåŠŸï¼', result.message);
                    currentData = result.data;
                    updateMetrics(result.data);
                    displayCrawlData(result.data); // æ˜¾ç¤ºçˆ¬å–æ•°æ®
                    loadFiles(); // é‡æ–°åŠ è½½æ–‡ä»¶åˆ—è¡¨
                } else {
                    showError('çˆ¬å–å¤±è´¥', result.error);
                }
            } catch (error) {
                showError('ç½‘ç»œé”™è¯¯', error.message);
            } finally {
                hideLoading('crawlLoading');
                showResult('crawlResult');
            }
        }

        // å¤„ç†åˆ†æ
        async function handleAnalyze() {
            const file = document.getElementById('analysisFile').value;
            const type = document.getElementById('analysisType').value;
            
            if (!file) {
                showError('è¯·é€‰æ‹©æ•°æ®æ–‡ä»¶', 'è¯·å…ˆçˆ¬å–æ•°æ®æˆ–é€‰æ‹©å·²æœ‰æ–‡ä»¶');
                return;
            }
            
            showLoading('analyzeLoading');
            hideResult('analyzeResult');
            
            try {
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        file: file,
                        type: type
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showSuccess('åˆ†ææˆåŠŸï¼', 'AIåˆ†æå·²å®Œæˆ');
                    displayAnalysisResult(result.data);
                    updateCharts(result.data);
                } else {
                    showError('åˆ†æå¤±è´¥', result.error);
                }
            } catch (error) {
                showError('ç½‘ç»œé”™è¯¯', error.message);
            } finally {
                hideLoading('analyzeLoading');
                showResult('analyzeResult');
            }
        }

        // ä¿å­˜APIå¯†é’¥
        async function saveApiKey() {
            const apiKey = document.getElementById('apiKey').value;
            
            try {
                const response = await fetch('/api/save-api-key', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ api_key: apiKey })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showSuccess('ä¿å­˜æˆåŠŸ', result.message);
                } else {
                    showError('ä¿å­˜å¤±è´¥', result.error);
                }
            } catch (error) {
                showError('ç½‘ç»œé”™è¯¯', error.message);
            }
        }

        // ä¿å­˜Cookies
        async function saveCookies() {
            // ä¼˜å…ˆå–è½¬æ¢ç»“æœï¼Œå¦åˆ™å–åŸå§‹è¾“å…¥
            let cookies = document.getElementById('jsonCookies').value.trim();
            if (!cookies) {
                cookies = document.getElementById('rawCookies').value.trim();
            }
            // æ ¡éªŒJSONæ ¼å¼
            try {
                if (cookies) {
                    JSON.parse(cookies);
                }
            } catch (e) {
                showError('ä¿å­˜å¤±è´¥', 'Cookiesä¸æ˜¯æœ‰æ•ˆçš„JSONæ ¼å¼ï¼Œè¯·ä½¿ç”¨è½¬æ¢å™¨è½¬æ¢åå†ä¿å­˜');
                return;
            }
            try {
                const response = await fetch('/api/save-cookies', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ cookies: cookies })
                });
                const result = await response.json();
                if (result.success) {
                    showSuccess('ä¿å­˜æˆåŠŸ', result.message);
                    // è‡ªåŠ¨åˆ·æ–°çˆ¬å–è¡¨å•å†…å®¹
                    document.getElementById('cookies').value = cookies;
                } else {
                    showError('ä¿å­˜å¤±è´¥', result.error);
                }
            } catch (error) {
                showError('ç½‘ç»œé”™è¯¯', error.message);
            }
        }

        // è½¬æ¢Cookiesæ ¼å¼
        function convertCookies() {
            const rawCookies = document.getElementById('rawCookies').value.trim();
            if (!rawCookies) {
                showError('è¯·è¾“å…¥Cookieæ•°æ®', 'è¯·ç²˜è´´ä»æµè§ˆå™¨å¤åˆ¶çš„Cookieæ ¼å¼');
                return;
            }

            try {
                const lines = rawCookies.split('\n').filter(line => line.trim());
                const cookieObj = {};

                lines.forEach(line => {
                    const parts = line.split('\t');
                    if (parts.length >= 2) {
                        const name = parts[0].trim();
                        const value = parts[1].trim();
                        
                        // è¿‡æ»¤æ‰ç©ºå€¼å’Œécookieå­—æ®µ
                        if (name && value && !name.startsWith('__') && !name.includes('RequestId')) {
                            cookieObj[name] = value;
                        }
                    }
                });

                const jsonCookies = JSON.stringify(cookieObj, null, 2);
                document.getElementById('jsonCookies').value = jsonCookies;
                document.getElementById('convertedCookies').style.display = 'block';
                
                showSuccess('è½¬æ¢æˆåŠŸ', `æˆåŠŸè½¬æ¢äº† ${Object.keys(cookieObj).length} ä¸ªCookie`);
            } catch (error) {
                showError('è½¬æ¢å¤±è´¥', 'Cookieæ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·æ£€æŸ¥è¾“å…¥');
            }
        }

        // ä½¿ç”¨è½¬æ¢åçš„Cookies
        function useConvertedCookies() {
            const jsonCookies = document.getElementById('jsonCookies').value;
            if (jsonCookies) {
                document.getElementById('cookies').value = jsonCookies;
                showSuccess('å·²åº”ç”¨', 'è½¬æ¢åçš„Cookieså·²åº”ç”¨åˆ°çˆ¬å–è¡¨å•');
            }
        }

        // æ¸…ç©ºCookies
        function clearCookies() {
            document.getElementById('cookies').value = '';
            showSuccess('å·²æ¸…ç©º', 'Cookieè¾“å…¥æ¡†å·²æ¸…ç©º');
        }

        // æ£€æŸ¥CookieçŠ¶æ€
        async function checkCookieStatus() {
            const statusBadge = document.getElementById('cookieStatus');
            const statusMessage = document.getElementById('cookieStatusMessage');
            const checkButton = document.getElementById('checkCookieStatus');
            
            // æ›´æ–°çŠ¶æ€ä¸ºæ£€æŸ¥ä¸­
            statusBadge.className = 'badge bg-secondary me-2';
            statusBadge.textContent = 'æ£€æŸ¥ä¸­...';
            statusMessage.textContent = 'æ­£åœ¨æ£€æŸ¥Cookieæœ‰æ•ˆæ€§...';
            checkButton.disabled = true;
            
            try {
                const response = await fetch('/api/cookie-status');
                const result = await response.json();
                
                if (result.valid) {
                    statusBadge.className = 'badge bg-success me-2';
                    statusBadge.textContent = 'æœ‰æ•ˆ';
                    statusMessage.textContent = `Cookieæœ‰æ•ˆï¼Œæœ€åæ£€æŸ¥æ—¶é—´ï¼š${result.last_check || 'æœªçŸ¥'}`;
                } else {
                    statusBadge.className = 'badge bg-danger me-2';
                    statusBadge.textContent = 'æ— æ•ˆ';
                    statusMessage.textContent = result.message || 'Cookieæ— æ•ˆï¼Œè¯·æ›´æ–°';
                }
            } catch (error) {
                statusBadge.className = 'badge bg-warning me-2';
                statusBadge.textContent = 'æ£€æŸ¥å¤±è´¥';
                statusMessage.textContent = 'æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨æ£€æŸ¥CookieçŠ¶æ€';
            } finally {
                checkButton.disabled = false;
            }
        }

        // åŠ è½½è®¾ç½®
        async function loadSettings() {
            try {
                // åŠ è½½APIå¯†é’¥
                const apiResponse = await fetch('/api/load-api-key');
                const apiResult = await apiResponse.json();
                if (apiResult.success) {
                    document.getElementById('apiKey').value = apiResult.api_key;
                }
                // åŠ è½½Cookies
                const cookiesResponse = await fetch('/api/load-cookies');
                const cookiesResult = await cookiesResponse.json();
                if (cookiesResult.success) {
                    // è‡ªåŠ¨å¡«å……åˆ°çˆ¬å–è¡¨å•
                    document.getElementById('cookies').value = cookiesResult.cookies;
                }
            } catch (error) {
                console.error('åŠ è½½è®¾ç½®å¤±è´¥:', error);
            }
        }

        // åŠ è½½æ–‡ä»¶åˆ—è¡¨
        async function loadFiles() {
            try {
                const response = await fetch('/api/files');
                const result = await response.json();
                
                if (result.success) {
                    updateFileList('dataFiles', result.data_files);
                    updateFileList('analysisFiles', result.analysis_files);
                    
                    // æ›´æ–°åˆ†ææ–‡ä»¶é€‰æ‹©å™¨
                    const analysisFileSelect = document.getElementById('analysisFile');
                    analysisFileSelect.innerHTML = '<option value="">é€‰æ‹©æ•°æ®æ–‡ä»¶...</option>';
                    result.data_files.forEach(file => {
                        const option = document.createElement('option');
                        option.value = file;
                        option.textContent = file;
                        analysisFileSelect.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('åŠ è½½æ–‡ä»¶åˆ—è¡¨å¤±è´¥:', error);
            }
        }

        // æ›´æ–°æ–‡ä»¶åˆ—è¡¨
        function updateFileList(containerId, files) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            if (files.length === 0) {
                container.innerHTML = '<p class="text-muted">æš‚æ— æ–‡ä»¶</p>';
                return;
            }
            
            files.forEach(file => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <div class="d-flex justify-content-between align-items-center">
                        <span><i class="fas fa-file me-2"></i>${file}</span>
                        <button class="btn btn-sm btn-outline-primary" onclick="downloadFile('${file}')">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>
                `;
                container.appendChild(fileItem);
            });
        }

        // ä¸‹è½½æ–‡ä»¶
        function downloadFile(filename) {
            window.open(`/api/download/${filename}`, '_blank');
        }

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading(loadingId) {
            document.getElementById(loadingId).style.display = 'block';
        }

        // éšè—åŠ è½½çŠ¶æ€
        function hideLoading(loadingId) {
            document.getElementById(loadingId).style.display = 'none';
        }

        // æ˜¾ç¤ºç»“æœ
        function showResult(resultId) {
            document.getElementById(resultId).style.display = 'block';
        }

        // éšè—ç»“æœ
        function hideResult(resultId) {
            document.getElementById(resultId).style.display = 'none';
        }

        // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯ï¼ˆåº•éƒ¨toastå¼¹çª—ï¼‰
        function showSuccess(title, message) {
            showToast(title, message, 'success');
        }

        // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ï¼ˆåº•éƒ¨toastå¼¹çª—ï¼‰
        function showError(title, message) {
            showToast(title, message, 'danger');
        }

        // é€šç”¨toastå¼¹çª—
        function showToast(title, message, type = 'success') {
            const toastContainer = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast align-items-center text-white bg-${type}`;
            toast.style = 'display: flex; justify-content: space-between; align-items: center; min-width: 320px; max-width: 90vw; margin-bottom: 10px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.15); pointer-events: auto; padding: 16px 24px; font-size: 1rem;';
            toast.innerHTML = `
                <div style="display: flex; flex-direction: column; align-items: flex-start;">
                    <strong style="font-size: 1.1em;">${title}</strong>
                    <span style="margin-top: 2px;">${message}</span>
                </div>
                <button type="button" class="btn-close btn-close-white ms-3" aria-label="å…³é—­" style="pointer-events: auto;" onclick="this.parentNode.remove()"></button>
            `;
            toastContainer.appendChild(toast);
            setTimeout(() => {
                toast.remove();
            }, 3500);
        }

        // æ›´æ–°æŒ‡æ ‡
        function updateMetrics(data) {
            if (data && data.length > 0) {
                document.getElementById('total-notes').textContent = data.length;
                
                // è®¡ç®—å¹³å‡ç‚¹èµ
                const likes = data.map(item => parseInt(item.likes) || 0);
                const avgLikes = likes.reduce((a, b) => a + b, 0) / likes.length;
                document.getElementById('avg-likes').textContent = Math.round(avgLikes);
            }
        }

        // æ˜¾ç¤ºçˆ¬å–æ•°æ®
        function displayCrawlData(data) {
            currentData = data;
            updateMetrics(data);
            renderBlogList(data);
            showResult('crawlResult');
        }

        // æ¸²æŸ“åšå®¢åˆ—è¡¨
        function renderBlogList(data) {
            const blogList = document.getElementById('blogList');
            const blogCount = document.getElementById('blogCount');
            
            blogList.innerHTML = '';
            blogCount.textContent = data ? data.length : 0;
            
            if (!data || data.length === 0) {
                blogList.innerHTML = '<div class="text-center text-muted py-3">æš‚æ— æ•°æ®</div>';
                return;
            }
            
            data.forEach((blog, index) => {
                const blogItem = document.createElement('div');
                blogItem.className = 'list-group-item blog-list-item';
                blogItem.onclick = () => selectBlog(index);
                
                blogItem.innerHTML = `
                    <div class="blog-title">${blog.title || 'æ— æ ‡é¢˜'}</div>
                    <div class="blog-meta">
                        <i class="fas fa-user me-1"></i>${blog.author || 'æœªçŸ¥ä½œè€…'}
                    </div>
                    <div class="blog-stats">
                        <div class="stat-item">
                            <i class="fas fa-heart text-danger"></i>
                            <span>${blog.likes || 0}</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-star text-warning"></i>
                            <span>${blog.collects || 0}</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-comment text-info"></i>
                            <span>${blog.comments || 0}</span>
                        </div>
                    </div>
                `;
                
                blogList.appendChild(blogItem);
            });
        }

        // é€‰æ‹©åšå®¢æ˜¾ç¤ºè¯¦æƒ…
        function selectBlog(index) {
            // ç§»é™¤æ‰€æœ‰activeç±»
            document.querySelectorAll('.blog-list-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // æ·»åŠ activeç±»åˆ°é€‰ä¸­çš„åšå®¢
            const selectedItem = document.querySelectorAll('.blog-list-item')[index];
            if (selectedItem) {
                selectedItem.classList.add('active');
            }
            
            // æ˜¾ç¤ºåšå®¢è¯¦æƒ…
            displayBlogDetail(currentData[index]);
        }

        // æ˜¾ç¤ºåšå®¢è¯¦æƒ…
        function displayBlogDetail(blog) {
            const blogDetail = document.getElementById('blogDetail');
            const selectedBlogTitle = document.getElementById('selectedBlogTitle');
            
            selectedBlogTitle.textContent = blog.title || 'æ— æ ‡é¢˜';
            
            blogDetail.innerHTML = `
                <div class="blog-detail-header">
                    <div class="blog-detail-title">${blog.title || 'æ— æ ‡é¢˜'}</div>
                    <div class="blog-detail-author">
                        <i class="fas fa-user-circle fa-2x text-primary"></i>
                        <div>
                            <div class="fw-bold">${blog.author || 'æœªçŸ¥ä½œè€…'}</div>
                            <small class="text-muted">${blog.publish_time || 'å‘å¸ƒæ—¶é—´æœªçŸ¥'}</small>
                        </div>
                    </div>
                    <div class="blog-detail-stats">
                        <div class="stat-card">
                            <div class="stat-value">${blog.likes || 0}</div>
                            <div class="stat-label">ç‚¹èµ</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${blog.collects || 0}</div>
                            <div class="stat-label">æ”¶è—</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${blog.comments || 0}</div>
                            <div class="stat-label">è¯„è®º</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${blog.share || 0}</div>
                            <div class="stat-label">åˆ†äº«</div>
                        </div>
                    </div>
                </div>
                
                <div class="blog-detail-content">
                    <div class="blog-detail-section">
                        <h5><i class="fas fa-info-circle me-2"></i>åŸºæœ¬ä¿¡æ¯</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>æ ‡é¢˜ï¼š</strong>${blog.title || 'æ— æ ‡é¢˜'}</p>
                                <p><strong>ä½œè€…ï¼š</strong>${blog.author || 'æœªçŸ¥ä½œè€…'}</p>
                                <p><strong>å‘å¸ƒæ—¶é—´ï¼š</strong>${blog.publish_time || 'æœªçŸ¥'}</p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>é“¾æ¥ï¼š</strong>${blog.url ? `<a href="${blog.url}" target="_blank">æŸ¥çœ‹åŸæ–‡</a>` : 'æ— é“¾æ¥'}</p>
                                <p><strong>å†…å®¹ç±»å‹ï¼š</strong>${blog.content_type || 'å›¾æ–‡'}</p>
                                <p><strong>æ ‡ç­¾ï¼š</strong>${blog.tags ? blog.tags.join(', ') : 'æ— æ ‡ç­¾'}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="blog-detail-section">
                        <h5><i class="fas fa-chart-bar me-2"></i>æ•°æ®åˆ†æ</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-body">
                                        <h6>äº’åŠ¨ç‡åˆ†æ</h6>
                                        <p>ç‚¹èµç‡ï¼š${calculateEngagementRate(blog.likes, blog.views)}%</p>
                                        <p>æ”¶è—ç‡ï¼š${calculateEngagementRate(blog.collects, blog.views)}%</p>
                                        <p>è¯„è®ºç‡ï¼š${calculateEngagementRate(blog.comments, blog.views)}%</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-body">
                                        <h6>å†…å®¹è´¨é‡è¯„ä¼°</h6>
                                        <p>ç»¼åˆè¯„åˆ†ï¼š${calculateContentScore(blog)}/10</p>
                                        <p>çƒ­åº¦ç­‰çº§ï¼š${getHeatLevel(blog.likes)}</p>
                                        <p>æ¨èæŒ‡æ•°ï¼š${getRecommendationLevel(blog)}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    ${blog.description ? `
                    <div class="blog-detail-section">
                        <h5><i class="fas fa-align-left me-2"></i>å†…å®¹æ‘˜è¦</h5>
                        <p>${blog.description}</p>
                    </div>
                    ` : ''}
                </div>
            `;
        }

        // è®¡ç®—äº’åŠ¨ç‡
        function calculateEngagementRate(interactions, views) {
            if (!views || views === 0) return 0;
            return ((interactions || 0) / views * 100).toFixed(2);
        }

        // è®¡ç®—å†…å®¹è´¨é‡è¯„åˆ†
        function calculateContentScore(blog) {
            let score = 5; // åŸºç¡€åˆ†
            
            // æ ¹æ®ç‚¹èµæ•°åŠ åˆ†
            const likes = parseInt(blog.likes) || 0;
            if (likes > 1000) score += 2;
            else if (likes > 100) score += 1;
            
            // æ ¹æ®æ”¶è—æ•°åŠ åˆ†
            const collects = parseInt(blog.collects) || 0;
            if (collects > 500) score += 2;
            else if (collects > 50) score += 1;
            
            // æ ¹æ®è¯„è®ºæ•°åŠ åˆ†
            const comments = parseInt(blog.comments) || 0;
            if (comments > 100) score += 1;
            
            return Math.min(score, 10);
        }

        // è·å–çƒ­åº¦ç­‰çº§
        function getHeatLevel(likes) {
            const likeCount = parseInt(likes) || 0;
            if (likeCount > 10000) return 'ğŸ”¥ çˆ†ç«';
            if (likeCount > 5000) return 'ğŸ”¥ çƒ­é—¨';
            if (likeCount > 1000) return 'ğŸ”¥ è¾ƒçƒ­';
            if (likeCount > 100) return 'ğŸ”¥ ä¸€èˆ¬';
            return 'ğŸ”¥ å†·é—¨';
        }

        // è·å–æ¨èæŒ‡æ•°
        function getRecommendationLevel(blog) {
            const score = calculateContentScore(blog);
            if (score >= 8) return 'â­â­â­â­â­ å¼ºçƒˆæ¨è';
            if (score >= 6) return 'â­â­â­â­ æ¨è';
            if (score >= 4) return 'â­â­â­ ä¸€èˆ¬';
            return 'â­â­ ä¸æ¨è';
        }

        function renderCrawlTable() {
            const tbody = document.getElementById('crawlDataTableBody');
            if (!tbody) return; // å¦‚æœè¡¨æ ¼ä¸å­˜åœ¨ï¼Œç›´æ¥è¿”å›
            
            tbody.innerHTML = '';
            if (!currentData || currentData.length === 0) return;
            // æœç´¢è¿‡æ»¤
            let filtered = currentData;
            if (tableState.search) {
                filtered = currentData.filter(item =>
                    (item.title && item.title.includes(tableState.search)) ||
                    (item.author && item.author.includes(tableState.search))
                );
            }
            // åˆ†é¡µ
            const total = filtered.length;
            const pageSize = tableState.pageSize;
            const page = tableState.page;
            const start = (page - 1) * pageSize;
            const end = Math.min(start + pageSize, total);
            const pageData = filtered.slice(start, end);
            // æ¸²æŸ“è¡¨æ ¼
            pageData.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${start + index + 1}</td>
                    <td><div class="text-truncate" style="max-width: 200px;" title="${item.title || 'æ— æ ‡é¢˜'}">${item.title || 'æ— æ ‡é¢˜'}</div></td>
                    <td><div class="text-truncate" style="max-width: 120px;" title="${item.author || 'æœªçŸ¥ä½œè€…'}">${item.author || 'æœªçŸ¥ä½œè€…'}</div></td>
                    <td><span class="badge bg-success">${item.likes || 0}</span></td>
                    <td><span class="badge bg-info">${item.collects || 0}</span></td>
                    <td><span class="badge bg-warning">${item.comments || 0}</span></td>
                    <td><small class="text-muted">${item.publish_time || 'æœªçŸ¥'}</small></td>
                    <td>${item.url ? `<a href="${item.url}" target="_blank" class="btn btn-sm btn-outline-primary"><i class="fas fa-external-link-alt"></i></a>` : '<span class="text-muted">æ— é“¾æ¥</span>'}</td>
                `;
                tbody.appendChild(row);
            });
            // åˆ†é¡µä¿¡æ¯
            const tablePageInfo = document.getElementById('tablePageInfo');
            if (tablePageInfo) {
                tablePageInfo.textContent = `å…±${total}æ¡ï¼Œ${page}/${Math.ceil(total/pageSize)}é¡µ`;
            }
            // æ¸²æŸ“åˆ†é¡µæŒ‰é’®
            renderTablePagination(Math.ceil(total/pageSize));
        }

        function renderTablePagination(totalPages) {
            const ul = document.getElementById('tablePagination');
            if (!ul) return; // å¦‚æœåˆ†é¡µå…ƒç´ ä¸å­˜åœ¨ï¼Œç›´æ¥è¿”å›
            
            ul.innerHTML = '';
            if (totalPages <= 1) return;
            for (let i = 1; i <= totalPages; i++) {
                const li = document.createElement('li');
                li.className = 'page-item' + (i === tableState.page ? ' active' : '');
                const a = document.createElement('a');
                a.className = 'page-link';
                a.href = '#';
                a.textContent = i;
                a.onclick = function(e) {
                    e.preventDefault();
                    tableState.page = i;
                    renderCrawlTable();
                };
                li.appendChild(a);
                ul.appendChild(li);
            }
        }

        // æ˜¾ç¤ºåˆ†æç»“æœ
        function displayAnalysisResult(data) {
            const container = document.getElementById('analysisContent');
            
            if (data.ai_analysis) {
                container.innerHTML = `
                    <div class="analysis-text">
                        <h5><i class="fas fa-brain me-2"></i>AIåˆ†æç»“æœ</h5>
                        <div>${data.ai_analysis}</div>
                    </div>
                `;
            }
            
            if (data.trends) {
                const trendsHtml = `
                    <div class="mt-4">
                        <h5><i class="fas fa-chart-line me-2"></i>è¶‹åŠ¿åˆ†æ</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <h6>çƒ­é—¨ä½œè€…</h6>
                                <ul>
                                    ${data.trends.top_authors ? data.trends.top_authors.map(author => 
                                        `<li>${author.author} (${author.count}ç¯‡)</li>`
                                    ).join('') : '<li>æš‚æ— æ•°æ®</li>'}
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6>çƒ­é—¨è¯é¢˜</h6>
                                <ul>
                                    ${data.trends.popular_topics ? data.trends.popular_topics.map(topic => 
                                        `<li>${topic.keyword} (${topic.frequency}æ¬¡)</li>`
                                    ).join('') : '<li>æš‚æ— æ•°æ®</li>'}
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
                container.innerHTML += trendsHtml;
            }
        }

        // åˆå§‹åŒ–å›¾è¡¨
        function initializeCharts() {
            // ä½œè€…åˆ†å¸ƒå›¾
            const authorCtx = document.getElementById('authorChart').getContext('2d');
            charts.authorChart = new Chart(authorCtx, {
                type: 'doughnut',
                data: {
                    labels: ['æš‚æ— æ•°æ®'],
                    datasets: [{
                        data: [1],
                        backgroundColor: ['#e9ecef']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'ä½œè€…åˆ†å¸ƒ'
                        }
                    }
                }
            });

            // ç‚¹èµåˆ†å¸ƒå›¾
            const likesCtx = document.getElementById('likesChart').getContext('2d');
            charts.likesChart = new Chart(likesCtx, {
                type: 'bar',
                data: {
                    labels: ['æš‚æ— æ•°æ®'],
                    datasets: [{
                        label: 'ç‚¹èµæ•°',
                        data: [0],
                        backgroundColor: '#ff2442'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'ç‚¹èµæ•°åˆ†å¸ƒ'
                        }
                    }
                }
            });

            // è¶‹åŠ¿å›¾
            const trendCtx = document.getElementById('trendChart').getContext('2d');
            charts.trendChart = new Chart(trendCtx, {
                type: 'line',
                data: {
                    labels: ['æš‚æ— æ•°æ®'],
                    datasets: [{
                        label: 'è¶‹åŠ¿',
                        data: [0],
                        borderColor: '#ff2442',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'å†…å®¹è¶‹åŠ¿'
                        }
                    }
                }
            });
        }

        // æ›´æ–°å›¾è¡¨
        function updateCharts(data) {
            if (data.charts) {
                // æ›´æ–°ä½œè€…åˆ†å¸ƒå›¾
                if (data.charts.author_distribution) {
                    charts.authorChart.data.labels = data.charts.author_distribution.labels;
                    charts.authorChart.data.datasets[0].data = data.charts.author_distribution.data;
                    charts.authorChart.data.datasets[0].backgroundColor = generateColors(data.charts.author_distribution.labels.length);
                    charts.authorChart.update();
                }

                // æ›´æ–°ç‚¹èµåˆ†å¸ƒå›¾
                if (data.charts.likes_distribution) {
                    charts.likesChart.data.labels = data.charts.likes_distribution.labels;
                    charts.likesChart.data.datasets[0].data = data.charts.likes_distribution.data;
                    charts.likesChart.update();
                }
            }
        }

        // ç”Ÿæˆé¢œè‰²
        function generateColors(count) {
            const colors = [
                '#ff2442', '#ff6b81', '#ff8fa3', '#28a745', '#20c997',
                '#ffc107', '#fd7e14', '#6f42c1', '#e83e8c', '#6c757d'
            ];
            
            const result = [];
            for (let i = 0; i < count; i++) {
                result.push(colors[i % colors.length]);
            }
            return result;
        }

        // å¯¼å‡ºè¡¨æ ¼ä¸ºCSV
        function exportTableToCsv() {
            const table = document.getElementById('crawlDataTable');
            if (!table) {
                showError('å¯¼å‡ºå¤±è´¥', 'æœªæ‰¾åˆ°æ•°æ®è¡¨æ ¼');
                return;
            }
            
            const rows = table.rows;
            const csv = [];

            for (let i = 0; i < rows.length; i++) {
                const row = rows[i];
                const cells = row.cells;
                const rowData = [];
                for (let j = 0; j < cells.length; j++) {
                    rowData.push(cells[j].textContent);
                }
                csv.push(rowData.join(','));
            }

            const csvContent = csv.join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);

            link.href = url;
            link.download = 'çˆ¬å–æ•°æ®.csv';
            link.click();

            URL.revokeObjectURL(url);
        }

        // å¯¼å‡ºåˆ†æç»“æœä¸ºJSON
        function exportAnalysisToJson() {
            const analysisContent = document.getElementById('analysisContent').innerHTML;
            const jsonContent = JSON.stringify({ analysis: analysisContent }, null, 2);
            const blob = new Blob([jsonContent], { type: 'application/json;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);

            link.href = url;
            link.download = 'åˆ†æç»“æœ.json';
            link.click();

            URL.revokeObjectURL(url);
        }

        // ä¸‹è½½å›¾è¡¨
        function downloadCharts() {
            // å®ç°ä¸‹è½½å›¾è¡¨çš„é€»è¾‘
            console.log('ä¸‹è½½å›¾è¡¨');
        }
        
        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchToTab(tabName) {
            const tab = document.getElementById(tabName + '-tab');
            if (tab) {
                tab.click();
            }
        }
    </script>
</body>
</html> 